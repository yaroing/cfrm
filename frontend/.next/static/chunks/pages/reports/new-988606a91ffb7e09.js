(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[186],{110:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/new",function(){return t(4211)}])},4211:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var r=t(5893),n=t(7294),a=t(1163),l=t(1255),i=t(214);function d(){let e=(0,a.useRouter)(),[s,t]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[o,m]=(0,n.useState)([]),[x,h]=(0,n.useState)([]),[u,g]=(0,n.useState)([]),[p,j]=(0,n.useState)([]),[f,N]=(0,n.useState)(null),[y,b]=(0,n.useState)({date_from:"",date_to:"",categories:[],statuses:[],priorities:[],channels:[],include_responses:!1,include_logs:!1});(0,n.useEffect)(()=>{v();let e=new Date,s=new Date(e.getTime()-2592e6);b(t=>({...t,date_from:s.toISOString().split("T")[0],date_to:e.toISOString().split("T")[0]}))},[]);let v=async()=>{try{t(!0);let[e,s,r,n]=await Promise.all([l.E.get("/categories/"),l.E.get("/statuses/"),l.E.get("/priorities/"),l.E.get("/channels/")]);m(e.results||e),h(s.results||s),g(r.results||r),j(n.results||n)}catch(e){console.error("Erreur lors du chargement des donn\xe9es de r\xe9f\xe9rence:",e)}finally{t(!1)}},w=(e,s)=>{b(t=>({...t,[e]:s}))},k=(e,s)=>{b(t=>({...t,[e]:t[e].includes(s)?t[e].filter(e=>e!==s):[...t[e],s]}))},_=async e=>{try{c(!0),N(null);let s=await l.E.post("/reports/generate/",{...y,format:e});s.download_url&&(N(s.download_url),window.open(s.download_url,"_blank"))}catch(e){var s,t;console.error("Erreur lors de la g\xe9n\xe9ration du rapport:",e),alert("Erreur lors de la g\xe9n\xe9ration du rapport: "+((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||e.message))}finally{c(!1)}};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement des donn\xe9es..."})]})}):(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Nouveau rapport"}),(0,r.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,r.jsx)("div",{className:"px-6 py-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Filtres du rapport"}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"P\xe9riode"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"date_from",className:"block text-sm text-gray-600",children:"Date de d\xe9but"}),(0,r.jsx)("input",{type:"date",id:"date_from",value:y.date_from,onChange:e=>w("date_from",e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"date_to",className:"block text-sm text-gray-600",children:"Date de fin"}),(0,r.jsx)("input",{type:"date",id:"date_to",value:y.date_to,onChange:e=>w("date_to",e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Cat\xe9gories"}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:o.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.categories.includes(e.id),onChange:()=>k("categories",e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Statuts"}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:x.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.statuses.includes(e.id),onChange:()=>k("statuses",e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Priorit\xe9s"}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:u.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.priorities.includes(e.id),onChange:()=>k("priorities",e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Canaux"}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:p.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.channels.includes(e.id),onChange:()=>k("channels",e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Options suppl\xe9mentaires"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.include_responses,onChange:e=>w("include_responses",e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Inclure les r\xe9ponses"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:y.include_logs,onChange:e=>w("include_logs",e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Inclure les logs d'activit\xe9"})]})]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"G\xe9n\xe9ration du rapport"}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-4",children:"Aper\xe7u des filtres"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"P\xe9riode :"})," ",y.date_from," - ",y.date_to]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Cat\xe9gories :"})," ",0===y.categories.length?"Toutes":y.categories.length+" s\xe9lectionn\xe9es"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Statuts :"})," ",0===y.statuses.length?"Tous":y.statuses.length+" s\xe9lectionn\xe9s"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Priorit\xe9s :"})," ",0===y.priorities.length?"Toutes":y.priorities.length+" s\xe9lectionn\xe9es"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Canaux :"})," ",0===y.channels.length?"Tous":y.channels.length+" s\xe9lectionn\xe9s"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"R\xe9ponses :"})," ",y.include_responses?"Incluses":"Non incluses"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Logs :"})," ",y.include_logs?"Inclus":"Non inclus"]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:()=>_("pdf"),disabled:d,className:"w-full flex items-center justify-center px-4 py-3 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"G\xe9n\xe9ration..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"G\xe9n\xe9rer PDF"]})}),(0,r.jsx)("button",{onClick:()=>_("excel"),disabled:d,className:"w-full flex items-center justify-center px-4 py-3 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"G\xe9n\xe9ration..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"G\xe9n\xe9rer Excel"]})})]}),f&&(0,r.jsx)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"Rapport g\xe9n\xe9r\xe9 avec succ\xe8s"}),(0,r.jsxs)("div",{className:"mt-2 text-sm text-green-700",children:[(0,r.jsx)("p",{children:"Le rapport a \xe9t\xe9 g\xe9n\xe9r\xe9 et t\xe9l\xe9charg\xe9 automatiquement."}),(0,r.jsx)("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"font-medium underline hover:text-green-600",children:"Cliquer ici pour le t\xe9l\xe9charger \xe0 nouveau"})]})]})]})})]})]})})})]})})}}},function(e){e.O(0,[430,117,214,774,888,179],function(){return e(e.s=110)}),_N_E=e.O()}]);