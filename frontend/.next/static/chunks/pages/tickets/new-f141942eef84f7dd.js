(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{6603:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets/new",function(){return t(9589)}])},9589:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return r}});var a=t(5893),i=t(7294),l=t(1163),n=t(1255),d=t(214);function r(){let e=(0,l.useRouter)(),[s,t]=(0,i.useState)(""),[r,o]=(0,i.useState)(""),[c,m]=(0,i.useState)(!1),[u,g]=(0,i.useState)(""),[x,h]=(0,i.useState)(""),[f,b]=(0,i.useState)(""),[p,v]=(0,i.useState)(""),[j,y]=(0,i.useState)(""),[N,k]=(0,i.useState)(""),[w,S]=(0,i.useState)(""),[C,_]=(0,i.useState)(""),[E,T]=(0,i.useState)(""),[q,O]=(0,i.useState)(""),[P,A]=(0,i.useState)(""),[D,F]=(0,i.useState)(""),[J,L]=(0,i.useState)(null),[I,X]=(0,i.useState)([]),[B,M]=(0,i.useState)([]),[R,Z]=(0,i.useState)([]),[z,G]=(0,i.useState)(!1),[H,K]=(0,i.useState)(null),[Q,U]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=async()=>{try{var e,s,t,a,i,l;let[d,r,o]=await Promise.all([n.E.get("/categories/"),n.E.get("/priorities/"),n.E.get("/channels/")]);X((null!==(s=null!==(e=null==d?void 0:d.results)&&void 0!==e?e:d)&&void 0!==s?s:[]).map(e=>({id:e.id,name:e.name}))),M((null!==(a=null!==(t=null==r?void 0:r.results)&&void 0!==t?t:r)&&void 0!==a?a:[]).map(e=>({id:e.id,name:e.name}))),Z((null!==(l=null!==(i=null==o?void 0:o.results)&&void 0!==i?i:o)&&void 0!==l?l:[]).map(e=>({id:e.id,name:e.name})))}catch(e){K("Impossible de charger les listes (cat\xe9gories/priorit\xe9s/canaux)")}};e()},[]);let V=async t=>{t.preventDefault(),G(!0),K(null),U(null);try{let t=new FormData;t.append("title",s),t.append("content",r),t.append("is_anonymous",String(c)),t.append("category",u),t.append("priority",x),t.append("channel",f),p&&t.append("external_id",p),j&&t.append("submitter_name",j),N&&t.append("submitter_phone",N),w&&t.append("submitter_email",w),C&&t.append("submitter_location",C),E&&t.append("latitude",E),q&&t.append("longitude",q),P&&t.append("tags",JSON.stringify(P.split(",").map(e=>e.trim()).filter(Boolean))),D&&t.append("metadata",D),J&&Array.from(J).forEach(e=>t.append("attachments",e)),await n.E.post("/tickets/",t,{headers:{"Content-Type":"multipart/form-data"}}),U("Ticket cr\xe9\xe9 avec succ\xe8s"),e.push("/tickets")}catch(s){var a,i,l;let e=(null==s?void 0:null===(i=s.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.detail)||(null==s?void 0:null===(l=s.response)||void 0===l?void 0:l.data)||"Erreur lors de la cr\xe9ation du ticket";K("string"==typeof e?e:JSON.stringify(e))}finally{G(!1)}};return(0,a.jsxs)(d.Z,{children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Nouveau ticket"})}),(0,a.jsxs)("div",{className:"mt-6 max-w-3xl",children:[H&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-700 border border-red-200",children:H}),Q&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-green-50 p-4 text-green-700 border border-green-200",children:Q}),(0,a.jsxs)("form",{onSubmit:V,className:"space-y-6",encType:"multipart/form-data",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Titre"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:s,onChange:e=>t(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Contenu"}),(0,a.jsx)("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",rows:5,value:r,onChange:e=>o(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"isAnonymous",type:"checkbox",checked:c,onChange:e=>m(e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,a.jsx)("label",{htmlFor:"isAnonymous",className:"ml-2 block text-sm text-gray-700",children:"Feedback anonyme"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Cat\xe9gorie"}),(0,a.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u,onChange:e=>g(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"S\xe9lectionner"}),I.map(e=>(0,a.jsx)("option",{value:String(e.id),children:e.name},String(e.id)))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Priorit\xe9"}),(0,a.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:x,onChange:e=>h(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"S\xe9lectionner"}),B.map(e=>(0,a.jsx)("option",{value:String(e.id),children:e.name},String(e.id)))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Canal"}),(0,a.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:f,onChange:e=>b(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"S\xe9lectionner"}),R.map(e=>(0,a.jsx)("option",{value:String(e.id),children:e.name},String(e.id)))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"External ID"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:p,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du plaignant"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:j,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xe9l\xe9phone"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:N,onChange:e=>k(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:w,onChange:e=>S(e.target.value)})]}),(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Localisation"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:C,onChange:e=>_(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Latitude"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:E,onChange:e=>T(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Longitude"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:q,onChange:e=>O(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tags (s\xe9par\xe9s par des virgules)"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:P,onChange:e=>A(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"M\xe9ta-donn\xe9es (JSON)"}),(0,a.jsx)("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:'{"key":"value"}',value:D,onChange:e=>F(e.target.value)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Pi\xe8ces jointes"}),(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>{L(e.target.files)},className:"mt-1 block w-full text-sm text-gray-700 file:mr-4 file:rounded-md file:border-0 file:bg-indigo-600 file:px-3 file:py-2 file:text-sm file:font-medium file:text-white hover:file:bg-indigo-700"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:z,className:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:z?"Cr\xe9ationâ€¦":"Cr\xe9er"})})]})]})]})}}},function(e){e.O(0,[430,117,214,774,888,179],function(){return e(e.s=6603)}),_N_E=e.O()}]);